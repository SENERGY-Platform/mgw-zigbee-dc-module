modfileVersion: "v1"
id: github.com/SENERGY-Platform/mgw-zigbee-dc-module
name: Zigbee Device-Connector
description: "after deployment the zigbee2mqtt ui has to be used to configure the used zigbee controller, mqtt-broker, permit_join etc"
version: v0.0.10
type: device-connector
deploymentType: single
license: "Apache License 2.0"
dependencies:
  github.com/SENERGY-Platform/mgw-mqtt-broker:
    version: <v2.0.0
    requiredServices:
      broker:
        - refVar: MGW_MQTT_BROKER
          template: "tcp://{ref}:1881"
          services:
            - mgw-zigbee-dc
        - refVar: ZIGBEE_MQTT_BROKER
          template: "tcp://{ref}:1881"
          services:
            - mgw-zigbee-dc
        - refVar: ZIGBEE2MQTT_CONFIG_SERVER
          template: "tcp://{ref}:1881"
          services:
            - zigbee2mqtt
hostResources:
  device:
    userInput:
      name: Zigbee Controller Device
    targets:
      - mountPoint: "/dev/zigbee"
        services:
          - zigbee2mqtt
services:
  zigbee2mqtt:
    name: zigbee2mqtt
    image: koenkk/zigbee2mqtt:1.37.0
    runConfig:
      pseudoTTY: true
    ports:
      - port: 8080
        hostPort: 8092
  mgw-zigbee-dc:
    name: mgw-zigbee-dc
    image: ghcr.io/senergy-platform/mgw-zigbee-dc:v1.0.4
volumes:
  zigbee2mqtt_store:
    - mountPoint: /app/data
      services:
        - zigbee2mqtt
secrets:
  auth:
    type: basic-auth
    targets:
      - refVar: AUTH_USERNAME
        item: username
        services:
          - mgw-zigbee-dc
      - refVar: AUTH_PASSWORD
        item: password
        services:
          - mgw-zigbee-dc
    userInput:
      name: Auth Credentials
configs:
  tz:
    dataType: string
    value: "Europe/Berlin"
    targets:
      - refVar: TZ
        services:
          - zigbee2mqtt
  zigbee2mqttSerialPort:
    dataType: string
    value: "/dev/zigbee"
    targets:
      - refVar: ZIGBEE2MQTT_CONFIG_SERIAL_PORT
        services:
          - zigbee2mqtt
  zigbee2mqttBaseTopic:
    dataType: string
    value: "zigbee2mqtt"
    targets:
      - refVar: ZIGBEE2MQTT_CONFIG_MQTT_BASE_TOPIC
        services:
          - zigbee2mqtt
  zigbee2mqttPermitJoin:
    dataType: string
    value: "true"
    targets:
      - refVar: ZIGBEE2MQTT_CONFIG_PERMIT_JOIN
        services:
          - zigbee2mqtt
  mqttClientId:
    dataType: string
    value: "mgw-zigbee-dc_zigbee"
    targets:
      - refVar: ZIGBEE_MQTT_CLIENT_ID
        services:
          - mgw-zigbee-dc
    userInput:
      type: text
      name: Zigbee MQTT ClientID
      group: mqtt
  mgwMqttClientId:
    dataType: string
    value: "mgw-zigbee-dc_mgw"
    targets:
      - refVar: MGW_MQTT_CLIENT_ID
        services:
          - mgw-zigbee-dc
  deviceIdPrefix:
    dataType: string
    value: "zigbee:"
    targets:
      - refVar: DEVICE_ID_PREFIX
        services:
          - mgw-zigbee-dc
    userInput:
      type: text
      name: Zigbee Device ID Prefix
      group: zigbee
  zigbeeTopicPrefixPrefix:
    dataType: string
    value: "zigbee2mqtt/"
    targets:
      - refVar: ZIGBEE_MQTT_TOPIC_PREFIX
        services:
          - mgw-zigbee-dc
    userInput:
      type: text
      name: Zigbee Topic Prefix
      group: zigbee
  authUrl:
    dataType: string
    value: "https://auth.senergy.infai.org"
    targets:
      - refVar: AUTH_ENDPOINT
        services:
          - mgw-zigbee-dc
    userInput:
      type: text
      name: Auth URL
      group: platform
  permissionSearchUrl:
    dataType: string
    value: "https://api.senergy.infai.org/permissions/query"
    targets:
      - refVar: PERMISSIONS_SEARCH_URL
        services:
          - mgw-zigbee-dc
    userInput:
      type: text
      name: Permission Search URL
      group: platform
inputGroups:
  mqtt:
    name: "MQTT"
  mgw:
    name: "MGW"
  platform:
    name: "Platform"
  zigbee:
    name: "Zigbee"